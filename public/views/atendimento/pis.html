<div id="page-header" class="row">
    <page-title icon="fa-warning" title="Pi's pendentes" description="Mostra as PI's que foram abertas porém ainda não receberam ação."></page-title>
</div>
<hr>
<table class="table" cellpadding="0" cellspacing="0">
    <thead>
        <tr>
            <th class="text-center" width="120">Nota</th>
            <th>Cliente</th>
            <th class="text-center">Abertura</th>
            <th class="text-center" width="150">Rastreio</th>
            <th class="text-center" width="120">PI</th>
            <th class="text-center" width="150">Motivo</th>
            <th width="130" style="min-width: 130px;"></th>
        </tr>
        <tr class="table-filter">
            <th>
                <input class="form-control big" ng-model="Pi.busca.pedido_id" placeholder="Nº da nota" ng-model-options="{debounce:500}" />
            </th>
            <th>
                <input class="form-control big" ng-model="Pi.busca.pedido.cliente.nome" placeholder="Nome do cliente" ng-model-options="{debounce:500}" />
            </th>
            <th>
                <div class="date-picker">
                    <input class="form-control small" ng-model="Pi.busca.pi.created_at_readable" ng-change="App.changeDate()" placeholder="Data"  />
                    <div class="picker-wrap">
                        <date-picker ng-model="Pi.busca.pi.created_at_readable"></date-picker>
                    </div>
                </div>
            </th>
            <th>
                <input class="form-control small" ng-model="Pi.busca.rastreio" placeholder="Rastreio" ng-model-options="{debounce:500}"  />
            </th>
            <th>
                <input class="form-control small" ng-model="Pi.busca.pi.codigo_pi" placeholder="Código" ng-model-options="{debounce:500}"  />
            </th>
            <th>
                <select ng-model="Pi.busca.pi.motivo_status" class="small form-control">
                    <option value="">Todos</option>
                    <option value="2">Atrasado</option>
                    <option value="3">Extraviado</option>
                    <option value="0">Outros</option>
                </select>
            </th>
            <th></th>
        </tr>
    </thead>
    <tbody ng-if="Pi.loading" class="loading">
        <tr><td colspan="50"><loading></loading></td></tr>
    </tbody>
    <tbody ng-if="Pi.rastreios && !Pi.loading">
        <tr ng-repeat="rastreio in Pi.rastreios | filter:Pi.busca:strict">
            <td class="text-center">
                <strong class="fs-11" ng-bind="rastreio.pedido.marketplace"></strong>
                <br>
                <small ng-bind="rastreio.pedido_id"></small>
            </td>
            <td>
                <strong ng-bind="rastreio.pedido.cliente.nome"></strong>
                <br>
                <small>
                    <span ng-bind="rastreio.pedido.cliente.fone"></span> - CEP: <strong ng-bind="rastreio.pedido.endereco.cep_readable"></strong> -
                    <span ng-bind="rastreio.pedido.endereco.cidade"></span> / <span ng-bind="rastreio.pedido.endereco.uf"></span>
                </small>
            </td>
            <td class="text-center" ng-bind="rastreio.pi.created_at_readable"></td>
            <td class="text-center">
                <a ng-bind="rastreio.rastreio" title="Rastrear código" target="_blank" ng-href="http://websro.correios.com.br/sro_bin/txect01$.Inexistente?P_LINGUA=001&P_TIPO=002&P_COD_LIS={{ rastreio.rastreio }}"></a>
            </td>
            <td class="text-center" ng-bind="rastreio.pi.codigo_pi"></td>
            <td class="status status-{{ pedido.pi.motivo_status }}">
                <div style="display: block;" ng-class="{
                        'alert-danger': rastreio.pi.motivo_status == 3 || rastreio.pi.motivo_status == 5 || rastreio.pi.motivo_status == 6,
                        'alert-warning': rastreio.pi.motivo_status == 2,
                        'alert-success': rastreio.pi.motivo_status == 4,
                        'alert-info': rastreio.pi.motivo_status == 1 || rastreio.pi.motivo_status == 7 || rastreio.pi.motivo_status == 8
                        }" class="alert m-b-0">
                    <strong ng-bind="rastreio.pi.status_description"></strong>
                </div>
            </td>
            <td>
                <div class="dropdown">
                    <button class="btn-info dropdown-toggle" type="button">
                        <i class="fa-cog"></i>&nbsp; Ações
                        <span class="caret"></span>
                    </button>
                    <ul class="dropdown-menu">
                        <li>
                            <a title="Editar pedido" ng-click="App.editar(rastreio)"><i class="fa-edit"></i>&nbsp; Editar</a>
                        </li>
                        <li>
                            <a title="Pedido de informação" ng-click="App.pi(rastreio)"><i class="fa-exclamation-triangle"></i>&nbsp; PI</a>
                        </li>
                        <li>
                            <a ng-click="App.printXML(rastreio.pedido_id)"><i class="fa-file-code-o"></i>&nbsp; XML</a>
                        </li>
                        <li>
                            <a ng-click="App.printDanfe(rastreio.pedido_id)"><i class="fa-file-pdf-o"></i>&nbsp; DANFE</a>
                        </li>
                        <li>
                            <a ng-click="App.printEtiqueta(rastreio.id)"><i class="fa-tag"></i>&nbsp; Etiqueta</a>
                        </li>
                    </ul>
                </div>
            </td>
        </tr>
    </tbody>
</table>